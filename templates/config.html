<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tesla Dashboard zur Anzeige aktueller Fahrzeugdaten">
    <meta name="keywords" content="Tesla, Dashboard, Fahrzeugdaten, Statistik, Karte, Elektroauto, Ladung, Stromverbrauch, Standort, Routenplanung, Fahrzeugstatus, Kilometerstand, Trip, Tesla Model S, Model 3, Model X, Model Y">
    <title>Dashboard Konfiguration</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    {% include 'analytics.html' %}
</head>
<body>
    <h1>Dashboard Konfiguration</h1>
    <form method="post" class="config-container">
        <section class="config-section">
            <h2>Dashboard Optionen</h2>
            {% for item in items %}
            <label class="checkbox">
                {% set default_checked = item.get('default', True) %}
                <input type="checkbox" name="{{ item.id }}" value="1" {% if config.get(item.id, default_checked) %}checked{% endif %}>
                {{ item.desc }}
            </label>
            {% endfor %}
        </section>

        {% if vehicles %}
        <section class="config-section">
            <h2>Fahrzeug</h2>
            <label>
                Fahrzeug auswählen
                <select name="vehicle_id">
                    {% for v in vehicles %}
                    <option value="{{ v.id }}" {% if v.id == selected_vehicle_id %}selected{% endif %}>{{ v.display_name }}</option>
                    {% endfor %}
                </select>
            </label>
        </section>
        {% endif %}

        <section class="config-section">
            <h2>APRS</h2>
            <label>
                APRS Rufzeichen
                <input type="text" name="aprs_callsign" value="{{ config.get('aprs_callsign','') }}">
            </label>
            <label>
                APRS Passcode
                <input type="text" name="aprs_passcode" value="{{ config.get('aprs_passcode','') }}">
            </label>
            <label class="checkbox">
                <input type="checkbox" name="aprs_wx_enabled" value="1" {% if config.get('aprs_wx_enabled', True) %}checked{% endif %}>
                APRS WX-Paket senden
            </label>
            <label>
                APRS WX Rufzeichen
                <input type="text" name="aprs_wx_callsign" value="{{ config.get('aprs_wx_callsign','') }}">
            </label>
            <label>
                APRS Kommentar
                <input type="text" name="aprs_comment" value="{{ config.get('aprs_comment','') }}">
            </label>
        </section>

        <section class="config-section">
            <h2>API</h2>
            <label>
                API Intervall (Sekunden)
                <input type="number" name="api_interval" min="1" step="1" value="{{ config.get('api_interval', 3) }}">
            </label>
            <label>
                API Intervall ohne Client (Sekunden)
                <input type="number" name="api_interval_idle" min="1" step="1" value="{{ config.get('api_interval_idle', 30) }}">
            </label>
        </section>

        <section class="config-section">
            <h2>Anzeige</h2>
            <label>
                Hinweistext
                <textarea name="announcement" rows="6">{{ config.get('announcement','') }}</textarea>
            </label>
        </section>

        <section class="config-section">
            <h2>Zugang</h2>
            <label>
                Blockierte IP-Adressen (kommagetrennt)
                <input type="text" name="blocked_ips" value="{{ config.get('blocked_ips','') }}">
            </label>
        </section>

        <section class="config-section">
            <h2>SMS</h2>
            <label>
                Handynummer des Fahrers
                <input type="text" name="phone_number" value="{{ config.get('phone_number','') }}">
            </label>
            <label>
                Infobip API Key
                <input type="text" name="infobip_api_key" value="{{ config.get('infobip_api_key','') }}">
            </label>
            <label>
                Infobip Basis-URL
                <input type="text" name="infobip_base_url" value="{{ config.get('infobip_base_url','https://api.infobip.com') }}">
            </label>
            <label>
                SMS Absender
                <input type="text" name="sms_sender_id" value="{{ config.get('sms_sender_id','') }}">
            </label>
            <label class="checkbox">
                <input type="checkbox" name="sms_enabled" value="1" {% if config.get('sms_enabled', True) %}checked{% endif %}>
                SMS-Versand erlauben
            </label>
            <label class="checkbox">
                <input type="checkbox" name="sms_drive_only" value="1" {% if config.get('sms_drive_only', True) %}checked{% endif %}>
                SMS nur während der Fahrt
            </label>
        </section>

        <section class="config-section">
            <h2>Taxameter</h2>
            <label>
                Taxiunternehmen
                <input type="text" name="taxi_company" value="{{ config.get('taxi_company','Taxi Schauer') }}">
            </label>
            <label>
                Slogan
                <input type="text" name="taxi_slogan" value="{{ config.get('taxi_slogan','Wir lassen Sie nicht im Regen stehen.') }}">
            </label>
            <label>
                Wartepreis je 10 Sekunden
                <input type="number" step="0.01" name="wait_price" value="{{ config.get('taximeter_tariff', {}).get('wait_per_10s', 0.10) }}">
            </label>

            <h3>Tarif (Euro)</h3>
            <label>
                Grundgebühr
                <input type="number" step="0.01" name="tariff_base" value="{{ config.get('taximeter_tariff', {}).get('base', 4.40) }}">
            </label>
            <label>
                1.–2. km
                <input type="number" step="0.01" name="tariff_12" value="{{ config.get('taximeter_tariff', {}).get('rate_1_2', 2.70) }}">
            </label>
            <label>
                3.–4. km
                <input type="number" step="0.01" name="tariff_34" value="{{ config.get('taximeter_tariff', {}).get('rate_3_4', 2.60) }}">
            </label>
            <label>
                ab 5. km
                <input type="number" step="0.01" name="tariff_5" value="{{ config.get('taximeter_tariff', {}).get('rate_5_plus', 2.40) }}">
            </label>
        </section>

        <div class="config-actions">
            <button type="submit">Speichern</button>
            <button type="submit" name="refresh_vehicle_list" value="1">Fahrzeugliste aktualisieren</button>
        </div>
    </form>
</body>
</html>

